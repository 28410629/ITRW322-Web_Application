<div class="chat-container">
  <div class="chat-header">

    <app-header></app-header>
    <app-header-user></app-header-user>

  </div>
  <div class="chat-main">

    <div id="frame" style="margin: 0px;">
      <div id="sidepanel">
        <div id="contacts">
          <!-- THIS IS THE ACTIVE CONVERSATIONS OF THE ACTIVE USER -->
          <div *ngIf="!SelectNewConversation">
            <ul style="list-style: none; padding-left: 0px">
              <li class="contact" [ngClass]="{'active': IsPublicChat}" (click)="SetPublicConversation()">
                <div class="wrap">
                  <img src="/assets/loadingProfile.png"/>
                  <div class="meta">
                    <p class="name">Public Channel</p>
                    <p class="preview">Channel available to all users.</p>
                  </div>
                </div>
              </li>

              <div *ngFor="let conversation of conversations">
                <li class="contact" [ngClass]="{'active': CurrentConversation.id === conversation.id && !IsPublicChat}" (click)="SetSelectedConversation(conversation.id, conversation)">
                  <div class="wrap">
                    <img src="{{ getChatPhoto(conversation.isgroupchat, conversation.groupPhotoURL, conversation.participants) }}"/>
                    <div class="meta">
                      <p class="name">{{ getChatName(conversation.isgroupchat, conversation.name, conversation.participants) }}</p>
                      <p class="preview">{{ getChatType(conversation.isgroupchat) }}</p>
                    </div>
                  </div>

                </li>

              </div>
            </ul>
          </div>
          <!-- THIS IS THE CREATE NEW CONVERSATIONS FOR THE ACTIVE USER -->
          <div *ngIf="SelectNewConversation">
            <ul style="list-style: none; padding-left: 0px">
              <li class="contact" >
                <div class="wrap">
                  <img src="/assets/loadingProfile.png"/>
                  <div class="meta">
                    <p class="name">Create Group Chat</p>
                    <p class="preview">Group Conversation</p>
                  </div>
                </div>
              </li>

              <div *ngFor="let user of users">
                <li class="contact" (click)="CreateNewDirectConversation(user.uid)" *ngIf="user.uid !== activeUser.uid">
                  <div class="wrap">
                    <img src="{{ getSenderImage(user.uid) }}"/>
                    <div class="meta">
                      <p class="name">{{ getSenderName(user.uid) }}</p>
                      <p class="preview">Direct Conversation</p>
                    </div>
                  </div>
                </li>

              </div>
            </ul>
          </div>
        </div>
        <div id="bottom-bar">
          <!-- THIS IS THE BUTtON CREATE NEW CONVERSATIONS FOR THE ACTIVE USER -->
          <div *ngIf="!SelectNewConversation">
            <button (click)="ShowSelectNewConversation()" id="addcontact"><i class="fa fa-user-plus fa-fw" aria-hidden="true"></i> <span>Start New Chat</span></button>
          </div>
          <!-- THIS IS THE BUTTON TO RETURN TO ACTIVE CONVERSATIONS FOR THE ACTIVE USER -->
          <div *ngIf="SelectNewConversation">
            <button (click)="HideSelectNewConversation()"><i class="fas fa-arrow-left fa-fw" aria-hidden="true"></i> <span>Back To Conversations</span></button>
          </div>
        </div>
      </div>
      <div class="content">
        <div class="contact-profile">
          <img src="{{ConversationPhoto}}" >
          <p>{{ ConversationName }}</p>
        </div>
        <div #scrollMe [scrollTop]="scrollMe.scrollHeight" class="messages" style="margin: 0px">
          <ul *ngFor="let message of Messages">
            <li [ngClass]="(message.uid == activeUser.uid)?'replies':'sent'">
              <img src="{{ getSenderImage(message.uid)}}"/>
              <p>
                <b class="name-of-user">{{getSenderName(message.uid)}}</b><br>
                {{ getGoodDate(message.datetime) | date:'dd MMM hh:mm' }}
                <markdown [data]="newLine"></markdown>
                <markdown [data]="decryptText(message.message)"></markdown>
              </p>
            </li>

          </ul>
        </div>
        <div class="message-input" style="background: white">
          <div class="wrap">
            <input type="text" [(ngModel)]="msgValue" placeholder="Write your message..." />
            <i class="fa fa-paperclip attachment" aria-hidden="true"></i>
            <button (click)="sendMessage()" class="submit"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="chat-footer">

    <app-footer></app-footer>

  </div>
</div>



